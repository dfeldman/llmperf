<!DOCTYPE html>
<html>
  <head>
    <title>LLMPerf</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f5f5f7;
      margin: 0;
      padding: 0;
    }

    .header {
      background-color: #1d1d1f;
      color: white;
      padding: 10px;
      margin: 0px;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      letter-spacing: 2px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .header h1 { 
      padding: 0; 
      margin: 0;
    }

    .tab {
      overflow: hidden;
      background-color: #f5f5f7;
      display: flex;
      justify-content: center;
    }

    .tab button {
      background-color: inherit;
      border: none;
      outline: none;
      cursor: pointer;
      padding: 14px 16px;
      transition: 0.3s;
      font-size: 17px;
      color: #1d1d1f;
      border-bottom: 2px solid transparent;
    }

    .tab button:hover {
      color: #0070c9;
    }

    .tab button.active {
      color: #0070c9;
      border-bottom: 2px solid #0070c9;
    }

    .tabcontent {
      display: none;
      padding: 20px;
    }

    .axis path,
    .axis line {
      fill: none;
      stroke: #1d1d1f;
      shape-rendering: crispEdges;
    }

    .axis text {
      font-size: 14px;
      fill: #1d1d1f;
    }
    
    .dot {
      stroke: #1d1d1f;
      cursor: pointer;
    }

    .dot-label {
      font-size: 12px;
      text-anchor: middle;
      fill: #1d1d1f;
    }
    .dot-label-bg {
      font-size: 12px;
      text-anchor: middle;
      fill: #1d1d1f;
    }
    
    .detail-panel {
      position: fixed;
      right: -320px;
      top: 120px;
      width: 300px;
      padding: 20px;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transition: right 0.3s;
    }

    .detail-panel.show {
      right: 20px;
    }

    .close-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 18px;
      cursor: pointer;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 20px;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: left;
    }

    th {
      background-color: #f5f5f7;
      font-weight: bold;
    }

    tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    .legend {
      margin-top: 20px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }

    .legend-color {
      width: 15px;
      height: 15px;
      margin-right: 5px;
    }

    .notification-bar {
      background: linear-gradient(to right, #f5deb3, #d2b48c);
      color: black;
      padding: 10px;
      text-align: center;
      font-size: 14px;
      border-radius: 10px;
      margin: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .tooltip {
      position: absolute;
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 10px;
      border-radius: 5px;
      pointer-events: none;
      font-size: 14px;
      line-height: 1.4;
      max-width: 250px;
      word-wrap: break-word;
    }

    .axis-label {
      font-size: 16px;
      font-weight: bold;
    }

    #graph {
      position: relative;
      width: 90%;
      height: calc(100vh - 150px);
      transition: width 0.3s;
    }

    #graph.sidebar-open {
      width: calc(100% - 320px);
    }

    #graphCore {
      background-color: white ;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transition: right 0.3s;
      margin:10px;
    }
    #footer {
      width: 100%;
      background-color: #1d1d1f;
      color: white;
      text-align: center;
      padding: 10px;
    }
    #footer a {
      color: white;
      text-decoration: none;
    }
  </style>
  </head>
  <body>
    <div class="header">
      <h1>LLMPerf</h1>
    </div>

    <div class="notification-bar">
      Updates: Added Haiku
    </div>

    <div class="tab">
      <button class="tablinks" onclick="openTab(event, 'graph')">Graph</button>
      <button class="tablinks" onclick="openTab(event, 'table')">Table</button>
      <button class="tablinks" onclick="openTab(event, 'openModels')">Open
        Models</button>
    </div>

    <div id="graph" class="tabcontent">
      <div>
        X-axis:
        <select id="xMetric">
          <option value="output_tokens_price_per_million">Output Tokens Price
            per Million (USD)</option>
          <option value="input_tokens_price_per_million">Input Tokens Price per
            Million (USD)</option>
        </select>
        Y-axis:
        <select id="yMetric">
          <option value="score">Chatbot Arena ELO</option>
          <option value="mmlu_score">MMLU Score</option>
          <option value="mt_bench">MT-Bench</option>
          <option value="context_length">Context</option>
        </select>
      </div>
      <div id="detailPanel" class="detail-panel">
        <span class="close-btn" onclick="closeDetailPanel()">&times;</span>
        <h2 id="selectedLLM"></h2>
        <p id="llmDescription"></p>
        <p>Company: <a id="companyLink" target="_blank"></a></p>
        <table id="llmStats">
          <tbody>
          </tbody>
        </table>
      </div>
      <div id="graphCore"></div>
      <div class="legend"></div>
    </div>

    <div id="table" class="tabcontent">
      <table id="dataTable">
        <thead>
          <tr>
            <th>Model/Service</th>
            <th>Company</th>
            <th>Input Tokens Price per Million (USD)</th>
            <th>Output Tokens Price per Million (USD)</th>
            <th>Context Length</th>
            <th>Chatbot Arena ELO</th>
            <th>MMLU Score</th>
            <th>MT-Bench</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
      <div class="legend"></div>

    </div>

    <div id="openModels" class="tabcontent">
      <h2>Open Models</h2>
      <p>This section is currently under development.</p>
    </div>

    <div id="footer">
    <h3>
      <a href="https://github.com/dfeldman/llmperf" target="_blank">
        <img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub Link" style="width: 32px; height: 32px;"> Edit on GitHub
      </a>
    </h3>
    </div>
    <script>
    const data = [
      {
        name: "Claude 3 Haiku",
        input_tokens_price_per_million: 0.25,
        output_tokens_price_per_million: 1.25,
        context_length: 200,
        score: 1179,
        mmlu_score: 75.2,
        mt_bench: null,
        gpqa: 33.3,
        human_eval: 75,
        company: "Anthropic",
        description: "Claude 3 Haiku is a powerful language model developed by Anthropic, offering high-quality text generation with a context length of 200K tokens.",
        companyWebsite: "https://www.anthropic.com"
      },
      {
        name: "Claude 3 Sonnet",
        input_tokens_price_per_million: 3,
        output_tokens_price_per_million: 15,
        context_length: 200,
        score: 1198,
        mmlu_score: 79.0,
        mt_bench: null,
        gpqa: 40.4,
        human_eval: 73,
        company: "Anthropic",
        description: "Claude 3 Sonnet is another impressive language model by Anthropic, providing excellent performance for various natural language tasks with a context length of 200K tokens.",
        companyWebsite: "https://www.anthropic.com"
      },
      {
        name: "Claude 3 Opus",
        input_tokens_price_per_million: 15,
        output_tokens_price_per_million: 75,
        context_length: 200,
        score: 1253,
        mmlu_score: 86.8,
        mt_bench: null,
        gpqa: 50.4,
        human_eval: 84.9,
        company: "Anthropic",
        description: "Claude 3 Opus is the most advanced language model in the Claude 3 series by Anthropic, delivering top-notch performance with a context length of 200K tokens.",
        companyWebsite: "https://www.anthropic.com"
      },
      {
        name: "GPT-4 Turbo (128k context)",
        input_tokens_price_per_million: 10,
        output_tokens_price_per_million: 30,
        context_length: 128,
        score: 1251,
        mmlu_score: 86.4,
        mt_bench: 9.32,
        gpqa: 35.7,
        human_eval: 74.5,
        company: "OpenAI",
        description: "GPT-4 Turbo is a high-performance language model by OpenAI, offering a context length of 128K tokens for efficient and accurate text generation.",
        companyWebsite: "https://www.openai.com"
      },
      {
        name: "GPT-4",
        input_tokens_price_per_million: 30,
        output_tokens_price_per_million: 60,
        context_length: 32,
        score: 1159,
        mmlu_score: 86.4,
        mt_bench: 8.96,
        gpqa: 35.7,
        human_eval: 74.5,
        company: "OpenAI",
        description: "GPT-4 is the latest groundbreaking language model by OpenAI, providing exceptional performance with context lengths of 8K and 32K tokens.",
        companyWebsite: "https://www.openai.com"
      },
      {
        name: "GPT-3.5 Turbo 0613",
        input_tokens_price_per_million: 0.50,
        output_tokens_price_per_million: 1.50,
        context_length: 16,
        score: 1114,
        mmlu_score: 70,
        mt_bench: 8.39,
        gpqa: 28.1,
        human_eval: null,
        company: "OpenAI",
        description: "GPT-3.5 Turbo 0613 is a powerful language model by OpenAI, offering a context length of 16K tokens for efficient and high-quality text generation.",
        companyWebsite: "https://www.openai.com"
      },
      {
        name: "Mistral Medium",
        input_tokens_price_per_million: 2.7,
        output_tokens_price_per_million: 8.1,
        context_length: 8,
        score: 1145,
        mmlu_score: null,
        mt_bench: null,
        gpqa: null,
        human_eval: null,
        company: "Mistral",
        description: "Mistral Medium is a language model developed by Mistral, offering a context length of 8K tokens for various natural language tasks.",
        companyWebsite: ""
      },
      {
        name: "Mistral Large",
        input_tokens_price_per_million: 8,
        output_tokens_price_per_million: 24,
        context_length: 32,
        score: 1157,
        mmlu_score: null,
        mt_bench: null,
        gpqa: null,
        human_eval: null,
        company: "Mistral",
        description: "Mistral Large is a more advanced language model by Mistral, delivering improved performance with a context length of 32K tokens.",
        companyWebsite: ""
      },
      {
        name: "Gemini Dev API",
        input_tokens_price_per_million: 0.50,
        output_tokens_price_per_million: 1.50,
        context_length: 128,
        score: 1125,
        mmlu_score: 83.7,
        mt_bench: null,
        gpqa: null,
        human_eval: 74.4,
        company: "Google",
        description: "Gemini Dev API is a language model offered by Google, providing a context length of 128K tokens for various natural language processing tasks.",
        companyWebsite: "https://www.google.com"
      },
      {
        name: "Gemini Advanced",
        input_tokens_price_per_million: null,
        output_tokens_price_per_million: null,
        context_length: 128,
        score: 1203,
        mmlu_score: null,
        mt_bench: null,
        gpqa: null,
        human_eval: null,
        company: "Google",
        description: "Gemini Advanced is a high-performance language model by Google, offering a context length of 128K tokens for advanced natural language applications.",
        companyWebsite: "https://www.google.com"
      },
    ];
  
  
  const graphContainer = d3.select("#graphCore");
  const margin = { top: 40, right: 20, bottom: 60, left: 60 };
  const width = 800 - margin.left - margin.right;
  const height = 600 - margin.top - margin.bottom;
  const svg = graphContainer.append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform", `translate(${margin.left},${margin.top})`);

  const xScale = d3.scaleLinear().range([0, width]);
  const yScale = d3.scaleLinear().range([height, 0]);
  const colorScale = d3.scaleOrdinal(d3.schemeCategory10);

  const xAxis = d3.axisBottom(xScale);
  const yAxis = d3.axisLeft(yScale);

  const tooltip = d3.select("body").append("div")
    .attr("class", "tooltip")
    .style("opacity", 0);





function update(xMetric, yMetric) {
    console.log("update");
    const filteredData = data.filter(d => d[xMetric] !== null && d[yMetric] !== null);

    svg.selectAll(".axis-layer").remove();
    svg.selectAll(".dot-layer").remove();
    svg.selectAll(".label-layer").remove();
    const axisLayer = svg.append("g").attr("class", "axis-layer");
    const dotLayer = svg.append("g").attr("class", "dot-layer");
    const labelLayer = svg.append("g").attr("class", "label-layer");

    xScale.domain(d3.extent(filteredData, d => d[xMetric])).nice();
    yScale.domain(d3.extent(filteredData, d => d[yMetric])).nice();
    console.log(d3.extent(filteredData, d => d[yMetric]))
      axisLayer.selectAll(".x-axis").remove();
      axisLayer.append("g")
        .attr("class", "x-axis")
        .attr("transform", `translate(0,${height})`)
        .call(xAxis)
        .append("text")
        .attr("class", "axis-label")
        .attr("x", (width - margin.left - margin.right) / 2)
        .attr("y", margin.bottom - 10)
        .attr("fill", "black")
        .style("text-anchor", "middle")
        .text(xMetric);

      axisLayer.selectAll(".y-axis").remove();
      axisLayer.append("g")
        .attr("class", "y-axis")
        .call(yAxis)
        .append("text")
        .attr("class", "axis-label")
        .attr("transform", "rotate(-90)")
        .attr("x", -(height - margin.top - margin.bottom) / 2)
        .attr("y", -margin.left + 20)
        .attr("fill", "black")
        .style("text-anchor", "middle")
        .style("z-index", "-1000")
        .text(yMetric);
      dotLayer.selectAll(".dot").remove();
      dotLayer.selectAll().remove();
      dotLayer.selectAll(".dot")
        .data(filteredData)
        .join("circle")
        .attr("class", "dot")
        .attr("cx", d => xScale(d[xMetric]))
        .attr("cy", d => yScale(d[yMetric]))
        .attr("r", 6)
        .style("fill", d => colorScale(d.company))
        .on("mouseover", function (event, d) {
          tooltip.transition()
            .duration(200)
            .style("opacity", .9);
          tooltip.html(`
            <strong>${d.name}</strong><br/>
            ${xMetric}: ${d[xMetric]}<br/>
            ${yMetric}: ${d[yMetric]}<br/>
            Company: ${d.company}
          `)
            .style("left", (event.pageX + 10) + "px")
            .style("top", (event.pageY - 28) + "px");
        })
        .on("mouseout", function (d) {
          tooltip.transition()
            .duration(500)
            .style("opacity", 0);
        })
        .on("click", function (event, d) {
          showDetailPanel(d);
        });

// Step 1: Render the text elements
const texts = labelLayer.selectAll(".dot-label")
  .data(filteredData)
  .join("text")
  .attr("class", "dot-label")
  .attr("x", d => xScale(d[xMetric]))
  .attr("y", d => yScale(d[yMetric]) - 12)
  .text(d => d.name)
  .style("text-anchor", "middle")
  .style("font-size", "12px")
  .style("fill", "#333");

  texts.each(function(d) {
  // Ensure accurate measurement by deferring until after render
  setTimeout(() => {
    const textWidth = this.getComputedTextLength();
    const padding = 10; // Adjust padding around text
    const rectHeight = 20; // Set your desired rect height

    // Adjust x position to center the rect behind the text
    const xPosition = xScale(d[xMetric]) - (textWidth / 2) - (padding / 2);
    const rectWidth = textWidth + padding;

    // Insert the rect before the text element so it appears behind
    labelLayer.insert("rect",":first-child") // Ensure rects are behind all texts
      .attr("x", xPosition)
      .attr("y", yScale(d[yMetric]) - rectHeight + (rectHeight / 4)-12) // Adjust Y position as needed
      .attr("width", rectWidth)
      .attr("height", rectHeight)
      .attr("rx", 5) // Customize the corner radius
      .style("fill", "#ccc") // Customize the fill color
      .attr("class", "dot-label-bg");

    // Ensure text is on top of the rect
    this.parentNode.appendChild(this);
  }
  
  
  , 0);
});  
    }
  
    function updateTable() {
      const tbody = d3.select("#dataTable tbody");
  
      const rows = tbody.selectAll("tr")
        .data(data)
        .join("tr");
  
      rows.selectAll("td")
        .data(d => [
          d.name,
          `<a href="${d.companyWebsite}" target="_blank">${d.company}</a>`,
          d.input_tokens_price_per_million,
          d.output_tokens_price_per_million,
          d.context_length,
          d.score,
          d.mmlu_score,
          d.mt_bench,
          d.gpqa,
          d.human_eval
        ])
        .join("td")
        .html(d => d);
  
      rows.style("background-color", d => colorScale(d.company));
    }
  
    function updateLegend() {
      const legend = d3.select(".legend");
  
      const legendItems = legend.selectAll(".legend-item")
        .data(colorScale.domain())
        .join("div")
        .attr("class", "legend-item");
  
      legendItems.append("div")
        .attr("class", "legend-color")
        .style("background-color", d => colorScale(d));
  
      legendItems.append("a")
        .text(d => d)
        .attr("href", d => data.find(item => item.company === d).companyWebsite)
        .attr("target", "_blank");
    }
  
    function showDetailPanel(d) {
      d3.select("#selectedLLM").text(d.name);
      d3.select("#llmDescription").text(d.description);
      d3.select("#companyLink")
        .text(d.company)
        .attr("href", d.companyWebsite);
  
      const statsTable = d3.select("#llmStats tbody");
      statsTable.html("");
  
      Object.entries(d).forEach(([key, value]) => {
        if (key !== "name" && key !== "description" && key !== "company" && key !== "companyWebsite") {
          statsTable.append("tr")
            .html(`<td>${key}</td><td>${value}</td>`);
        }
      });
  
      d3.select("#detailPanel").classed("show", true);
      graphContainer.classed("sidebar-open", true);
      resizeGraph();
    }
  
    function closeDetailPanel() {
      d3.select("#detailPanel").classed("show", false);
      graphContainer.classed("sidebar-open", false);
      resizeGraph();
    }
  
    function resizeGraph() {
    width = graphContainer.node().getBoundingClientRect().width - margin.left - margin.right;
    height = graphContainer.node().getBoundingClientRect().height - margin.top - margin.bottom;

    svg.attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom);

    svg.select("g")
      .attr("transform", `translate(${margin.left},${margin.top})`);

    xScale.range([0, width]);
    yScale.range([height, 0]);

    update(d3.select("#xMetric").property("value"), d3.select("#yMetric").property("value"));
  }
  
    function openTab(evt, tabName) {
      const tabcontent = document.getElementsByClassName("tabcontent");
      for (let i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }
  
      const tablinks = document.getElementsByClassName("tablinks");
      for (let i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
      }
  
      document.getElementById(tabName).style.display = "block";
      evt.currentTarget.className += " active";
    }
  
    update("output_tokens_price_per_million", "score");
    updateTable();
    updateLegend();
  
    d3.select("#xMetric").on("change", function () {
      update(this.value, d3.select("#yMetric").property("value"));
    });
  
    d3.select("#yMetric").on("change", function () {
      update(d3.select("#xMetric").property("value"), this.value);
    });
  
    window.addEventListener("resize", resizeGraph);
  
    document.getElementsByClassName("tablinks")[0].click();
  </script>
  </body>
</html>